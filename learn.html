<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
    <style>
        html{
          height: 100%;
        }
        * {
            font-family: "Montserrat", "sans-serif"
        }
        body{
          background-image: url(https://wallpaperaccess.com/full/1630430.jpg);
          background-size: 100% 100%;
          background-repeat: no-repeat;
          background-attachment: fixed;
          background-position: center;
        }
        .list-group {
          width: 80%;
          margin: auto;
        }
    </style>

  </head>
  <body>
      <div id = "bod">
        <ul class="list-group" id="dynamic-list"></ul>
      </div>

    <script>
        var uname = sessionStorage.getItem("usernamea")
        const Http = new XMLHttpRequest();
        const url='https://script.google.com/macros/s/AKfycbzMxHnjjPKcUcb2ffDyef10slO3-E9GtxPXG5k_EvJv1Jdod3E/exec';
        var data = "?action=gettut";
        Http.open("GET", String(url+data));
        Http.send();

        Http.onreadystatechange = (e) => {
            ok = Http.responseText;
            console.log(String(ok));
            console.log(Http.readyState);
            ok = JSON.parse(ok);
        if (Http.readyState == 4)
        {
            renderlist(ok)
        }
        }

        function renderlist(list){
            for(i = 0;i<list.length;i++) {
                addTutor(list[i]);
            } 
        }



        function alertName(x) {
            alert(x);
        }

        function addTutor(x) {
            var ul = document.getElementById("dynamic-list");
            var li = document.createElement("li");
            li.style["background-color"] = "rgba(128,128,128 ,.75 )";
            li.style["color"] = "white";
            li.style["font-size"]="3vmin";
            li.setAttribute('id', x.name);
            li.setAttribute('class','list-group-item');

            li.appendChild(document.createElement("h1").appendChild(document.createTextNode(x.name)));
            var chaticon = document.createElement('button');
            chaticon.setAttribute('id', x.name)
            chaticon.setAttribute('class', 'btn btn-primary')
            chaticon.setAttribute('onclick', 'connect(this.id)')
            chaticon.innerHTML = 	'&#65291; Connect' 
            chaticon.style["background-color"]="rgba(64, 69, 132, .65)";
            chaticon.style["outline"]="none";
            chaticon.style["border-style"]="none";
            chaticon.style["position"] = "absolute";
            chaticon.style["right"]="0";
            chaticon.style["margin-right"]="2vw";             

            li.appendChild(document.createElement("br"));
            li.appendChild(document.createElement("p").appendChild(document.createTextNode(x.subjects )));
            li.appendChild(chaticon)
            li.appendChild(document.createElement("br"));
            li.appendChild(document.createElement("p").appendChild(document.createTextNode(x.reviews+' \u2B50' )));
            ul.appendChild(li);
            

        }

        function connect(x){
            const Http = new XMLHttpRequest();
            const url='https://script.google.com/macros/s/AKfycbzMxHnjjPKcUcb2ffDyef10slO3-E9GtxPXG5k_EvJv1Jdod3E/exec';
            var data = "?tutor="+x+"&student="+uname+"&action=connect";
            Http.open("GET", String(url+data));
            Http.send();

            Http.onreadystatechange = (e) => {
                ok = Http.responseText;

                ok = String(ok);
                if (Http.readyState == 4)
                {
                    if(ok=="true"){
                        alert("Succesfully connected!")
                    }
                    else{

                        alert("Server error")
                    }
                }
            }
        }
    </script>
  </body>
</html>
